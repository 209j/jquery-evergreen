<!DOCTYPE html><html lang="en"><head><title>je/selector</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="je/selector"><meta name="groc-project-path" content="src/je/selector.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/je/selector.js</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="selector">Selector</h1></div></div></div><div class="segment"><div class="code"><div class="wrapper">import { makeIterable } from <span class="string">'./util'</span>;

<span class="keyword">var</span> slice = [].slice,
    hasProto = !Object.prototype.isPrototypeOf({__proto__: <span class="literal">null</span>}),
    reFragment = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,
    reSingleTag = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,
    reSimpleSelector = <span class="regexp">/^[\.#]?[\w-]*$/</span>;</div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h2 id="">$</h2>
<p>Versatile wrapper for <code>querySelectorAll</code>.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>selector can be a String, a Node, or a NodeList.</strong><br/>(Query selector. Providing a selector string gives the default behavior. Providing a Node or NodeList will return a NodeList or $Object containing the same element(s). Providing a string that looks like HTML (i.e. starts with a <code>&lt;tag&gt;</code>) results in an attempt to create a DOM Fragment from it.)</p>
</li>
<li><p><strong>context can be a String, a Node, or a NodeList and has a default value of <code>document</code>.</strong><br/>(The context for the selector to query elements.)</p>
</li>
</ul>
<p><strong>Returns a NodeList or a $Object</strong></p></div></div><div class="code"><div class="wrapper"><span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span><span class="params">(selector, context)</span> {</span>

    <span class="keyword">var</span> collection;

    <span class="keyword">if</span>(!selector) {

        collection = document.querySelectorAll(<span class="literal">null</span>);

    } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">typeof</span> selector !== <span class="string">'string'</span>) {

        collection = makeIterable(selector);

    } <span class="keyword">else</span> <span class="keyword">if</span>(reFragment.test(selector)) {

        collection = createFragment(selector);

    } <span class="keyword">else</span> {

        context = context ? <span class="keyword">typeof</span> context === <span class="string">'string'</span> ? document.querySelector(context) : context.length ? context[<span class="number">0</span>] : context : document;

        collection = querySelector(selector, context);

    }

    <span class="keyword">return</span> $.isNative ? collection : wrap(collection);

};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="find">Find</h2>
<p>Chaining for the <code>$</code> wrapper (aliasing <code>find</code> for <code>$</code>).</p>
<pre><code>$(&#39;.selectors).find(&#39;.deep&#39;).$(&#39;.deepest&#39;);</code></pre></div></div><div class="code"><div class="wrapper"><span class="keyword">var</span> find = <span class="function"><span class="keyword">function</span><span class="params">(selector)</span> {</span>
    <span class="keyword">return</span> $(selector, <span class="keyword">this</span>);
};</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method querySelector</span></p>
<p>Use the faster <code>getElementById</code> or <code>getElementsByClassName</code> over <code>querySelectorAll</code> if possible.</p>
<p>Parameters:</p>
<ul>
<li><p><strong>selector must be a String.</strong><br/>(Query selector.)</p>
</li>
<li><p><strong>context must be a Node.</strong><br/>(The context for the selector to query elements.)</p>
</li>
</ul>
<p><strong>Returns a NodeList or a Node</strong></p></div></div><div class="code"><div class="wrapper"><span class="keyword">var</span> querySelector = <span class="function"><span class="keyword">function</span><span class="params">(selector, context)</span> {</span>

    <span class="keyword">var</span> isSimpleSelector = reSimpleSelector.test(selector);

    <span class="keyword">if</span>(isSimpleSelector &amp;&amp; !$.isNative) {
        <span class="keyword">if</span>(selector[<span class="number">0</span>] === <span class="string">'#'</span>) {
            <span class="keyword">return</span> (context.getElementById ? context : document).getElementById(selector.slice(<span class="number">1</span>));
        }
        <span class="keyword">if</span>(selector[<span class="number">0</span>] === <span class="string">'.'</span>) {
            <span class="keyword">return</span> context.getElementsByClassName(selector.slice(<span class="number">1</span>));
        }
        <span class="keyword">return</span> context.getElementsByTagName(selector);
    }

    <span class="keyword">return</span> context.querySelectorAll(selector);

};</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method createFragment</span></p>
<p>Create DOM fragment from an HTML string</p>
<p>Parameters:</p>
<ul>
<li><strong>html must be a String.</strong><br/>(String representing HTML.)</li>
</ul>
<p><strong>Returns a NodeList</strong></p></div></div><div class="code"><div class="wrapper"><span class="keyword">var</span> createFragment = <span class="function"><span class="keyword">function</span><span class="params">(html)</span> {</span>

    <span class="keyword">if</span>(reSingleTag.test(html)) {
        <span class="keyword">return</span> document.createElement(RegExp.$<span class="number">1</span>);
    }

    <span class="keyword">var</span> fragment = document.createDocumentFragment(),
        container = document.createElement(<span class="string">'div'</span>);

    container.innerHTML = html.trim();

    <span class="keyword">while</span>(container.firstChild) {
        fragment.appendChild(container.firstChild);
    }

    <span class="keyword">return</span> fragment.childNodes;
};</div></div></div><div class="segment"><div class="comments doc-section doc-section-private"><div class="wrapper"><p><span class='doc-section-header'>Private method wrap</span></p>
<p>Calling <code>$(selector)</code> returns a wrapped array of elements <a href="mode.html">by default</a>.</p>
<p>Parameters:</p>
<ul>
<li><strong>collection can be a NodeList, a Node, or an Array.</strong><br/>(Element(s) to wrap as a <code>$Object</code>.)</li>
</ul>
<p><strong>Returns a $Object</strong><br/>(Array with augmented API.)</p></div></div><div class="code"><div class="wrapper"><span class="keyword">var</span> wrap = <span class="function"><span class="keyword">function</span><span class="params">(collection)</span> {</span>

    <span class="keyword">var</span> wrapped = collection <span class="keyword">instanceof</span> Array ? collection : collection.length !== <span class="literal">undefined</span> ? slice.call(collection) : [collection],
        methods = $.apiMethods;

    <span class="keyword">if</span> (hasProto) {
        wrapped.__proto__ = methods;
    } <span class="keyword">else</span> {
        <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> methods) {
            wrapped[key] = methods[key];
        }
    }

    <span class="keyword">return</span> wrapped;
};</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Export interface</p></div></div><div class="code"><div class="wrapper">export { $, find };</div></div></div></div></body></html>